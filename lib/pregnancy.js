// Pregnancy information by week
// Covers weeks 4-12 (early pregnancy, most relevant for Feb 2026 based on late Dec/early Jan conception)

export const pregnancyWeeks = {
  4: {
    baby: "The embryo is implanting into the uterine wall. It's about the size of a poppy seed.",
    mom: "She might not know she's pregnant yet. Some women experience light spotting (implantation bleeding) or mild cramping. Fatigue may begin.",
    weeklyAction: { text: "Pick up a prenatal vitamin for her if she hasn't started yet", emoji: "üíä" },
    support: [
      "Be attentive to her energy levels without being overbearing",
      "Make sure there's plenty of water around the house",
      "Start taking on more household tasks quietly",
      "Be patient if she seems tired or emotional"
    ]
  },
  5: {
    baby: "The heart is beginning to form and will start beating this week. Baby is the size of a sesame seed.",
    mom: "Morning sickness may begin. Breast tenderness, fatigue, and frequent urination are common. Emotions may feel intense.",
    weeklyAction: { text: "Put crackers and ginger tea by her bedside", emoji: "ü´ö" },
    support: [
      "Keep crackers by the bedside for morning nausea",
      "Don't wear strong cologne or cook pungent foods",
      "Offer ginger tea or ginger candies",
      "Be emotionally present‚Äîjust listen without trying to fix"
    ]
  },
  6: {
    baby: "The neural tube is closing. Tiny buds for arms and legs appear. Baby is the size of a lentil.",
    mom: "Nausea often peaks. She may have food aversions, heightened sense of smell, and extreme fatigue. Mood swings are common.",
    weeklyAction: { text: "Take over meal planning for the week", emoji: "üçΩÔ∏è" },
    support: [
      "Ask what foods sound tolerable before cooking",
      "Take over meal planning if she can't think about food",
      "Let her rest without guilt‚Äîgrowing a human is exhausting",
      "Validate her feelings without minimizing them"
    ]
  },
  7: {
    baby: "Brain development is rapid. Hands and feet are forming. Baby is the size of a blueberry.",
    mom: "Nausea continues. She may experience bloating, constipation, and vivid dreams. First prenatal appointment often happens this week.",
    weeklyAction: { text: "Write down 3 questions for the first OB appointment", emoji: "üìù" },
    support: [
      "Offer to go to every appointment‚Äîyour presence matters",
      "Stock up on high-fiber foods and prunes",
      "Create a calm bedtime routine together",
      "Start a shared journal or notes app for questions for the doctor"
    ]
  },
  8: {
    baby: "All major organs are beginning to develop. Baby is moving, though she can't feel it yet. Size of a kidney bean.",
    mom: "Nausea may be at its worst. Fatigue is intense. She might feel like she's on an emotional rollercoaster.",
    weeklyAction: { text: "Bring her flowers or her favorite comfort treat", emoji: "üíê" },
    support: [
      "This is often the hardest week‚Äîbe extra patient and loving",
      "Don't take mood swings personally",
      "Small gestures matter: bring her a cold cloth, rub her back",
      "Remind her this phase is temporary"
    ]
  },
  9: {
    baby: "Baby is starting to look more human. Tiny muscles are forming. Size of a grape.",
    mom: "Nausea may start to ease for some. Waistline may be thickening. She might feel anxious about the pregnancy.",
    weeklyAction: { text: "Plan a low-key date night at home", emoji: "üïØÔ∏è" },
    support: [
      "Reassure her that anxiety is normal",
      "Start researching together‚Äîbirth classes, hospitals, etc.",
      "Celebrate small wins: 'We made it through another week'",
      "Plan a low-key date that doesn't involve food smells"
    ]
  },
  10: {
    baby: "Vital organs are fully formed and beginning to function. Baby is the size of a kumquat.",
    mom: "Energy might slightly improve. Visible veins may appear on breasts and belly. Round ligament pain may start.",
    weeklyAction: { text: "Go on a walk together ‚Äî even 15 minutes counts", emoji: "üö∂" },
    support: [
      "Encourage gentle movement‚Äîwalks together are great",
      "Help her stay hydrated (dehydration worsens everything)",
      "Be flexible with plans‚Äîshe may need to cancel last minute",
      "Start talking about your hopes and dreams for your family"
    ]
  },
  11: {
    baby: "Baby is now officially a fetus. Tooth buds and nail beds are forming. Size of a fig.",
    mom: "Nausea often improves. She may feel bloated and have skin changes (acne or 'glow'). Headaches are common.",
    weeklyAction: { text: "Give her a genuine compliment about something specific", emoji: "üí¨" },
    support: [
      "Keep pain relievers she can safely take on hand (check with doctor)",
      "Offer head and neck massages",
      "Compliment her genuinely‚Äîshe may not feel attractive",
      "Take photos if she's comfortable‚Äîyou'll treasure these"
    ]
  },
  12: {
    baby: "Reflexes are developing‚Äîbaby can open and close fingers. Size of a lime. Risk of miscarriage drops significantly.",
    mom: "Many women start feeling better! Energy often returns. She may start 'showing' slightly. This is often when couples share the news.",
    weeklyAction: { text: "Plan how you'll share the news with loved ones together", emoji: "üéâ" },
    support: [
      "Celebrate reaching this milestone together",
      "Discuss when/how to share the news with family and friends",
      "Start thinking about nursery ideas if she's ready",
      "Plan something special‚Äîyou've both made it through the hardest part"
    ]
  },
  13: {
    baby: "Vocal cords are forming. Fingerprints are developing. Size of a peapod.",
    mom: "Welcome to the second trimester! Energy typically improves. Libido may return. The 'pregnancy glow' often appears.",
    weeklyAction: { text: "Research and book a babymoon destination", emoji: "‚úàÔ∏è" },
    support: [
      "Reconnect intimately if she's interested‚Äîfollow her lead",
      "Plan a babymoon if schedules allow",
      "Start reading about childbirth together",
      "Express gratitude for everything she's going through"
    ]
  },
  14: {
    baby: "Baby can make facial expressions. Body is growing faster than the head now. Size of a lemon.",
    mom: "Appetite often increases. She may feel more like herself. Some women experience nasal congestion ('pregnancy rhinitis').",
    weeklyAction: { text: "Cook her favorite nutritious meal from scratch", emoji: "üë®‚Äçüç≥" },
    support: [
      "Cook nutritious meals she's craving",
      "Get a humidifier for the bedroom if she's congested",
      "Enjoy this more stable phase together",
      "Keep up the habits you've built‚Äîshe needs a healthy partner too"
    ]
  },
  15: {
    baby: "Baby can sense light through closed eyelids. Legs are now longer than arms. Size of an apple.",
    mom: "The 'golden period' of pregnancy begins. Energy is up, nausea usually gone. She may start feeling flutters (quickening).",
    weeklyAction: { text: "Start a baby names list together", emoji: "üìã" },
    support: [
      "Ask about baby names if she's ready to discuss",
      "Start planning the nursery together",
      "Take a prenatal class or tour the hospital",
      "Keep exercising together‚Äîwalks, swimming, or yoga"
    ]
  },
  16: {
    baby: "Baby can hear sounds! Facial muscles are working, and baby may start sucking their thumb. Size of an avocado.",
    mom: "She may feel the baby move for the first time. Appetite is often strong. Back pain and round ligament pain may increase.",
    weeklyAction: { text: "Read or sing to the baby ‚Äî they can hear you now", emoji: "üìñ" },
    support: [
      "Put your hand on her belly when she feels movement",
      "Offer back rubs and foot massages regularly",
      "Help with groceries and healthy meal prep",
      "Read or sing to the baby‚Äîthey can hear you now"
    ]
  },
  17: {
    baby: "Baby is developing fat stores and sweat glands. Skeleton is hardening from cartilage to bone. Size of a pear.",
    mom: "Growing belly is more noticeable. She may experience vivid dreams, increased appetite, and occasional dizziness.",
    weeklyAction: { text: "Get her a pregnancy pillow if she doesn't have one", emoji: "üõèÔ∏è" },
    support: [
      "Help her find comfortable sleeping positions (left side is best)",
      "Stock up on healthy, satisfying snacks",
      "Start discussing birth preferences together",
      "Be her advocate at medical appointments"
    ]
  },
  18: {
    baby: "Baby is yawning, hiccupping, and swallowing. If it's a girl, her uterus and fallopian tubes are formed. Size of a sweet potato.",
    mom: "Anatomy scan is typically scheduled (18-22 weeks). She may feel stronger movements. Possible swelling in feet and ankles.",
    weeklyAction: { text: "Schedule or confirm the anatomy scan appointment", emoji: "üìÖ" },
    support: [
      "Attend the anatomy scan together‚Äîthis is a big one",
      "Help her elevate her feet when they're swollen",
      "Start thinking about a birth plan together",
      "Capture this milestone‚Äîjournal or photos"
    ]
  },
  19: {
    baby: "A protective coating called vernix caseosa covers the skin. Baby's senses are developing rapidly. Size of a mango.",
    mom: "She may experience hip pain, leg cramps, and skin changes. The halfway point is approaching!",
    weeklyAction: { text: "Research pediatricians in your area together", emoji: "üë®‚Äç‚öïÔ∏è" },
    support: [
      "Celebrate the upcoming halfway milestone together",
      "Help with stretching exercises for hip and leg relief",
      "Research pediatricians and childcare options",
      "Keep communicating openly about both your feelings"
    ]
  },
  20: {
    baby: "Halfway there! Baby can hear your voice clearly now. Taste buds are developing. Size of a banana.",
    mom: "The uterus is at belly button level. She may feel Braxton Hicks contractions. Energy is generally good.",
    weeklyAction: { text: "Celebrate the halfway mark ‚Äî plan something special", emoji: "ü•Ç" },
    support: [
      "Celebrate this huge milestone‚Äîyou're halfway!",
      "Talk to the baby regularly‚Äîyour voice is becoming familiar",
      "Start planning a babymoon if schedules allow",
      "Review finances and parental leave options"
    ]
  },
  21: {
    baby: "Baby's movements are more coordinated. Eyebrows and eyelids are fully formed. Size of a carrot.",
    mom: "Stretch marks may appear. She may feel the baby's sleep/wake cycle. Braxton Hicks may become more noticeable.",
    weeklyAction: { text: "Help apply belly moisturizer before bed", emoji: "üß¥" },
    support: [
      "Offer to apply moisturizer on her belly for comfort",
      "Notice the baby's active times and share in the excitement",
      "Start assembling baby gear and the nursery",
      "Plan together for the third trimester ahead"
    ]
  },
  22: {
    baby: "Baby looks like a miniature newborn. Lips and eyelids are more distinct. Grip is getting stronger. Size of a papaya.",
    mom: "She may experience backaches, swollen ankles, and trouble sleeping. Appetite continues to increase.",
    weeklyAction: { text: "Sign up for a childbirth education class", emoji: "üéì" },
    support: [
      "Help create a comfortable sleep environment",
      "Take over more household responsibilities",
      "Attend childbirth education classes together",
      "Remind her (and yourself) how strong you both are"
    ]
  },
  23: {
    baby: "Baby can hear loud sounds from outside. Skin is still translucent but filling out. Size of a large mango.",
    mom: "She may have swollen hands and feet, especially in warm weather. Braxton Hicks contractions may increase.",
    weeklyAction: { text: "Write her a letter about what you're looking forward to as a dad", emoji: "‚úâÔ∏è" },
    support: [
      "Help her stay cool and comfortable",
      "Offer foot massages in the evening",
      "Start thinking about baby-proofing the home",
      "Share your own feelings about becoming a father"
    ]
  },
  24: {
    baby: "Baby's face is almost fully formed. Lungs are developing branches. Size of an ear of corn.",
    mom: "Viability milestone ‚Äî baby could survive outside the womb with medical help. She may feel emotional about this.",
    weeklyAction: { text: "Start a registry or list of baby essentials together", emoji: "üõí" },
    support: [
      "Acknowledge how far you've both come",
      "Begin researching baby gear and essentials",
      "Plan finances for baby-related expenses",
      "Take her out for a special dinner"
    ]
  },
  25: {
    baby: "Baby responds to your voice with movement. Fat is accumulating, giving a plumper appearance. Size of a rutabaga.",
    mom: "Frequent bathroom trips, shortness of breath, and heartburn are common. Sleep may be increasingly difficult.",
    weeklyAction: { text: "Do a deep clean or organize one room in the house", emoji: "üßπ" },
    support: [
      "Keep antacids handy for heartburn",
      "Adjust pillows to help her sleep more comfortably",
      "Take on more of the physical chores",
      "Plan short, restful activities together"
    ]
  },
  26: {
    baby: "Baby's eyes open for the first time. They can see light and shadow. Size of a scallion bunch.",
    mom: "Third trimester begins! She may feel heavier and more uncomfortable. Nesting instincts may kick in.",
    weeklyAction: { text: "Start setting up the nursery or baby's sleeping area", emoji: "üçº" },
    support: [
      "Help with nesting projects‚Äîorganize, clean, build furniture",
      "Be patient with her changing needs and moods",
      "Finalize your birth plan together",
      "Make sure the car seat is purchased and you know how to install it"
    ]
  },
  27: {
    baby: "Baby has regular sleep cycles now. Hiccups are common and she can feel them! Size of a head of cauliflower.",
    mom: "Leg cramps, back pain, and restless sleep are common. She may start feeling more anxious about labor.",
    weeklyAction: { text: "Practice installing the car seat together", emoji: "üöó" },
    support: [
      "Research labor support techniques and positions",
      "Pack a preliminary hospital bag together",
      "Keep reassuring her about the birth process",
      "Stay active together‚Äîprenatal yoga or evening walks"
    ]
  },
  28: {
    baby: "Baby can blink, dream, and has regular breathing movements. Size of a large eggplant.",
    mom: "Braxton Hicks are more frequent. She may feel huge and uncomfortable. The finish line is in sight.",
    weeklyAction: { text: "Pack the hospital bag ‚Äî both hers and yours", emoji: "üß≥" },
    support: [
      "Make sure the hospital bag is packed and ready",
      "Know the route to the hospital and have a backup plan",
      "Keep her comfortable with back rubs and gentle support",
      "Celebrate ‚Äî you're in the home stretch!"
    ]
  },
  29: {
    baby: "Baby's bones are fully developed but still soft. Brain is growing rapidly. Size of a butternut squash.",
    mom: "Difficulty sleeping, frequent urination, and shortness of breath continue. She may feel impatient to meet the baby.",
    weeklyAction: { text: "Cook and freeze 3 meals for after the baby arrives", emoji: "ü•ò" },
    support: [
      "Prepare freezer meals for after the birth",
      "Finalize childcare and family support plans",
      "Keep the house clean and organized",
      "Spend quality time together as a couple"
    ]
  },
  30: {
    baby: "Baby is about 3 pounds and gaining weight fast. They can grab their own feet! Size of a large cabbage.",
    mom: "She may feel constant pressure, heartburn, and fatigue. Nesting instincts may be in overdrive.",
    weeklyAction: { text: "Write down your birth plan preferences as a team", emoji: "üìÑ" },
    support: [
      "Review the birth plan one more time together",
      "Ensure all baby essentials are purchased and ready",
      "Give her space to rest while handling logistics",
      "Tell her how proud you are of her"
    ]
  }
};

export const pregnancyMilestones = [
  {
    week: 6, label: "First heartbeat detectable", emoji: "üíì",
    description: "An ultrasound can pick up a tiny flickering heartbeat ‚Äî 100 to 160 beats per minute. The embryo is only about 4mm, but that heartbeat changes everything.",
    couple: "This is often the first time it hits both of you emotionally. If you can be at this ultrasound together, be there. Hold her hand. You'll both remember this moment."
  },
  {
    week: 8, label: "First prenatal visit", emoji: "üè•",
    description: "The first official OB appointment. Expect bloodwork, a full health history, and usually an ultrasound to confirm dating and viability.",
    couple: "Go together. Write down questions beforehand ‚Äî you'll both forget in the moment. This visit sets the tone for how involved you are. She'll notice, and it matters."
  },
  {
    week: 10, label: "NIPT / genetic screening window", emoji: "üß¨",
    description: "Non-Invasive Prenatal Testing screens for chromosomal conditions with a simple blood draw. Results come back in 1-2 weeks and can also reveal the baby's sex.",
    couple: "Have an honest conversation beforehand about what you want to learn. There's no right answer ‚Äî just make sure you're on the same page. This is a moment to lean into each other."
  },
  {
    week: 12, label: "End of first trimester", emoji: "üéâ",
    description: "Miscarriage risk drops significantly. Many couples share the news more broadly now. The baby's major organs and systems are all formed.",
    couple: "This is a huge exhale for both of you. It's also a good time to celebrate privately ‚Äî you've made it through the hardest stretch of early pregnancy together."
  },
  {
    week: 13, label: "Second trimester begins", emoji: "‚ú®",
    description: "The 'golden trimester.' Morning sickness typically eases, energy returns, and the belly starts showing. Baby is about 3 inches and moving constantly.",
    couple: "Energy and mood often improve. This is a great window for a babymoon, for reconnecting, and for enjoying the pregnancy before the third trimester intensity."
  },
  {
    week: 16, label: "Baby can hear your voice", emoji: "üëÇ",
    description: "The baby's ears are developed enough to hear sounds ‚Äî your voice, her heartbeat, music. Studies show babies recognize voices they heard in the womb.",
    couple: "Start talking to the baby. Read aloud at night. Play music you love. Your baby is learning your voice right now. She'll love watching you do this."
  },
  {
    week: 18, label: "Anatomy scan (18-22w)", emoji: "üì∑",
    description: "The detailed anatomy scan checks brain, heart, spine, kidneys, and limbs. This is the 'big ultrasound' ‚Äî usually 30 to 45 minutes. Many couples learn the sex here.",
    couple: "This is the appointment most couples say feels like meeting their baby. You'll see fingers, toes, a face. Be present, ask questions, take the printout home ‚Äî first family photo."
  },
  {
    week: 20, label: "Halfway there", emoji: "üéØ",
    description: "20 weeks down, 20 to go. Baby is about 10 inches long, weighing around 10 ounces. She's likely feeling regular, recognizable movement now.",
    couple: "Celebrate this. Start having real conversations about birth preferences, parenting values, and life with a newborn. The second half moves fast."
  },
];

export function calculatePregnancyWeek(lmpDate, cycleLength = 28) {
  const today = new Date();
  const lmp = new Date(lmpDate);
  
  // Adjust for cycle length (standard calculation assumes 28-day cycle)
  const ovulationDay = cycleLength - 14;
  const adjustment = ovulationDay - 14; // Days to add/subtract from standard
  
  const daysSinceLMP = Math.floor((today - lmp) / (1000 * 60 * 60 * 24));
  const adjustedDays = daysSinceLMP - adjustment;
  
  const weeks = Math.floor(adjustedDays / 7);
  const days = adjustedDays % 7;
  
  return { weeks, days, totalDays: adjustedDays };
}

export function getPregnancyInfo(lmpDate, cycleLength = 28) {
  const { weeks, days } = calculatePregnancyWeek(lmpDate, cycleLength);
  
  // Get info for current week, default to week 4 or 14 if out of range
  let weekInfo;
  if (weeks < 4) {
    weekInfo = {
      baby: "It's very early! The fertilized egg is making its way to the uterus.",
      mom: "She likely doesn't know she's pregnant yet. No symptoms typically.",
      support: [
        "Continue being a supportive partner",
        "Focus on your own health and preparation",
        "Stay positive and present"
      ]
    };
  } else if (weeks > 30) {
    weekInfo = pregnancyWeeks[30];
  } else {
    weekInfo = pregnancyWeeks[weeks];
  }
  
  return {
    weeks,
    days,
    weekLabel: `${weeks} weeks, ${days} days`,
    trimester: weeks < 13 ? 1 : weeks < 27 ? 2 : 3,
    ...weekInfo
  };
}

export function getPregnancyPercentage(lmpDate, cycleLength = 28) {
  const { weeks, days } = calculatePregnancyWeek(lmpDate, cycleLength);
  const totalDays = weeks * 7 + days;
  const fullTermDays = 40 * 7; // 280 days = 40 weeks
  return {
    percent: Math.min(Math.round((totalDays / fullTermDays) * 100), 100),
    weeks,
    days,
    totalDays,
    fullTermDays
  };
}

export function getEstimatedDueDate(lmpDate, cycleLength = 28) {
  const lmp = new Date(lmpDate + 'T12:00:00');
  const ovulationDay = cycleLength - 14;
  const adjustment = ovulationDay - 14;
  const dueDate = new Date(lmp);
  dueDate.setDate(dueDate.getDate() + 280 + adjustment);
  return dueDate;
}

export function getPregnancyInfoAtDate(lmpDate, targetDate, cycleLength = 28) {
  const lmp = new Date(lmpDate);
  const target = new Date(targetDate);
  const ovulationDay = cycleLength - 14;
  const adjustment = ovulationDay - 14;
  const daysSinceLMP = Math.floor((target - lmp) / (1000 * 60 * 60 * 24));
  const adjustedDays = daysSinceLMP - adjustment;
  const weeks = Math.floor(adjustedDays / 7);
  const days = adjustedDays % 7;

  let weekInfo;
  if (weeks < 4) {
    weekInfo = {
      baby: "It's very early! The fertilized egg is making its way to the uterus.",
      mom: "She likely doesn't know she's pregnant yet. No symptoms typically.",
      support: ["Continue being a supportive partner", "Focus on your own health", "Stay positive and present"]
    };
  } else if (weeks > 30) {
    weekInfo = pregnancyWeeks[30];
  } else {
    weekInfo = pregnancyWeeks[weeks] || pregnancyWeeks[22];
  }

  const trimester = weeks < 13 ? 1 : weeks < 27 ? 2 : 3;
  const upcomingMilestones = pregnancyMilestones.filter(m => m.week >= weeks && m.week <= weeks + 4);

  return { weeks, days, trimester, ...weekInfo, upcomingMilestones };
}

export function getWeeklyAction(lmpDate, cycleLength = 28) {
  const { weeks } = calculatePregnancyWeek(lmpDate, cycleLength);
  const weekData = pregnancyWeeks[weeks] || pregnancyWeeks[Math.min(Math.max(weeks, 4), 30)];
  if (weekData?.weeklyAction) {
    return { ...weekData.weeklyAction, week: weeks };
  }
  return { text: "Check in with your partner ‚Äî ask how she's really feeling", emoji: "üí¨", week: weeks };
}

export function getDailyTip(lmpDate, cycleLength = 28) {
  const info = getPregnancyInfo(lmpDate, cycleLength);
  const dayOfWeek = new Date().getDay();
  
  // Rotate through support tips based on day
  const tipIndex = dayOfWeek % info.support.length;
  
  return {
    ...info,
    todaysTip: info.support[tipIndex]
  };
}
